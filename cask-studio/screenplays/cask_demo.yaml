title: "cask demo — Governance Proof"
output: "cask_demo"
variables:
  demo_dir: "{{tmp_dir}}/cask_demo_sim"
settings:
  width: 1280
  height: 1200
  font_size: 18
  theme: "Catppuccin Mocha"
  padding: 24
  window_bar: "Colorful"
  framerate: 60
  line_height: 1.15
  letter_spacing: 0
preinstall:
  - "rm -rf {{demo_dir}} && mkdir -p {{demo_dir}}"
  - |
    cat > {{demo_dir}}/demo.sh <<'SH'
    #!/bin/bash
    # Simulates real cask demo output (matches actual output 1:1)
    echo ""
    echo "============================================================"
    echo "Demo complete"
    echo "============================================================"
    echo ""
    echo "8 tools compiled from bundled API fixture:"
    echo ""
    sleep 0.2
    echo "  DELETE /api/users/{id}                 delete_user"
    echo "  GET    /api/products                   get_products"
    echo "  GET    /api/products/{id}              get_product"
    echo "  GET    /api/users                      get_users"
    echo "  GET    /api/users/{id}                 get_user"
    echo "  POST   /api/orders                     create_order"
    echo "  POST   /api/users                      create_user"
    echo "  PUT    /api/users/{id}                 update_user"
    echo ""
    sleep 0.2
    echo "Pending:      8 tools awaiting approval"
    echo ""
    echo "What just happened:"
    echo "  1. Analyzed 8 API endpoints from sample traffic"
    echo "  2. Generated type-safe tools with security classifications"
    echo "  3. Created approval workflow (tools need review before agents can use them)"
    sleep 0.3
    echo ""
    echo "============================================================"
    echo "  Phase 1: Governance enforcement check"
    echo "============================================================"
    sleep 0.2
    echo "  ✓ Fail-closed: runtime blocked without lockfile"
    sleep 0.1
    echo "  ✓ Tools approved via lockfile"
    sleep 0.3
    echo ""
    echo "============================================================"
    echo "  Phase 2: Deterministic replay parity"
    echo "============================================================"
    sleep 0.2
    echo "  Replaying action: get_products"
    sleep 0.1
    echo "  Run A: ✓ allowed"
    sleep 0.1
    echo "  Run B: ✓ allowed"
    sleep 0.1
    echo "  Parity: ✓ deterministic"
    sleep 0.3
    echo ""
    echo "============================================================"
    echo "  Results"
    echo "============================================================"
    echo "  Governance enforced:  ✓"
    echo "  Replay parity:        ✓"
    echo "  Drift count:          0"
    SH
    chmod +x {{demo_dir}}/demo.sh
scenarios:
  - label: "cask demo"
    surface: "terminal"
    prompt:
      style: "venv"
      env: ".venv"
      user: "user"
      host: "dev"
      path: "basename"
      symbol: "$"
    setup:
      - "cd {{demo_dir}}"
      - "clear"
    actions:
      - type: "bash demo.sh"
      - wait_for: "Drift count"
        wait_mode: "screen"
        wait_timeout: "30s"
      - sleep: "2000ms"
