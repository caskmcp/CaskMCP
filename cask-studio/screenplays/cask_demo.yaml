title: "cask demo — Governance Proof in 30 Seconds"
output: "cask_demo"
variables:
  demo_dir: "{{tmp_dir}}/cask_demo_run"
settings:
  width: 1280
  height: 1000
  font_size: 20
  theme: "Catppuccin Mocha"
  padding: 24
  window_bar: "Colorful"
  framerate: 60
  line_height: 1.15
  letter_spacing: 0
preinstall:
  - "rm -rf {{demo_dir}} && mkdir -p {{demo_dir}}"
  - |
    cat > {{demo_dir}}/fake_demo.sh <<'SH'
    #!/bin/bash
    echo ""
    echo "  Cask Demo — Governance Proof"
    echo "  =============================="
    echo ""
    sleep 0.4
    echo "  Step 1/4: Compiling toolpack from fixtures..."
    sleep 0.5
    echo "    Discovered 8 endpoints"
    echo "    Compiled 8 tools (3 read, 4 write, 1 delete)"
    echo "    Risk classification: 2 critical, 3 high, 2 medium, 1 low"
    echo "    Artifact: toolpack.yaml (SHA-256: a1b2c3d4...)"
    echo ""
    sleep 0.4
    echo "  Step 2/4: Enforcing lockfile governance..."
    sleep 0.4
    echo "    Lockfile: caskmcp.lock.yaml"
    echo "    Approved: 6 tools"
    echo "    Blocked:  2 tools (delete_all_users, admin_reset)"
    echo "    Unsigned: 0"
    echo "    Result: PASS (fail-closed enforcement active)"
    echo ""
    sleep 0.4
    echo "  Step 3/4: Proving deterministic replay parity..."
    sleep 0.5
    echo "    Run A digest: SHA-256:e5f6a7b8..."
    echo "    Run B digest: SHA-256:e5f6a7b8..."
    echo "    Parity: MATCH"
    echo ""
    sleep 0.4
    echo "  Step 4/4: Emitting evidence..."
    sleep 0.3
    echo "    prove_summary.json"
    echo "    prove_twice_report.md"
    echo "    prove_twice_diff.json"
    echo ""
    sleep 0.3
    echo "  =============================="
    echo "  RESULT: PASS"
    echo "  Governance held. Parity proved. Exit code 0."
    SH
    chmod +x {{demo_dir}}/fake_demo.sh
scenarios:
  - label: "cask demo"
    surface: "terminal"
    prompt:
      style: "venv"
      env: ".venv"
      user: "user"
      host: "dev"
      path: "basename"
      symbol: "$"
    setup:
      - "cd {{demo_dir}}"
      - "clear"
    actions:
      - type: "bash fake_demo.sh"
      - wait_for: "RESULT: PASS"
        wait_mode: "screen"
        wait_timeout: "20s"
      - sleep: "2000ms"
