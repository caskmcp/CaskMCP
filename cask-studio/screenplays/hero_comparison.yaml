title: "Cask: Ungoverned vs Governed Agent Tools"
output: "hero_comparison"
variables:
  demo_dir: "{{tmp_dir}}/cask_hero"
settings:
  width: 1400
  height: 800
  font_size: 20
  theme: "Catppuccin Mocha"
  padding: 24
  window_bar: "Colorful"
  framerate: 60
  line_height: 1.15
  letter_spacing: 0
preinstall:
  - "rm -rf {{demo_dir}} && mkdir -p {{demo_dir}}"
  - |
    cat > {{demo_dir}}/ungoverned.sh <<'SH'
    #!/bin/bash
    # Simulate a typical unprotected MCP agent session
    echo ""
    echo "  Agent session started — no governance layer"
    echo ""
    sleep 0.3
    echo "  → POST /api/admin/delete-all      200 OK"
    sleep 0.2
    echo "  → POST /api/billing/charge         200 OK"
    sleep 0.2
    echo "  → GET  /api/users/export           200 OK"
    sleep 0.2
    echo "  → POST /ext/analytics.io/track     200 OK"
    echo ""
    sleep 0.4
    echo "  ✗ No approval required"
    echo "  ✗ No audit trail"
    echo "  ✗ No drift detection"
    echo "  ✗ Third-party calls invisible"
    echo ""
    sleep 0.3
    echo '  "It worked... but what did it do?"'
    SH
    chmod +x {{demo_dir}}/ungoverned.sh
  - |
    cat > {{demo_dir}}/governed.sh <<'SH'
    #!/bin/bash
    # Simulate real cask serve enforcement (matches actual runtime behavior)
    echo ""
    echo "  Lockfile loaded: 8 tools (6 approved, 2 blocked)"
    echo "  Enforcement: fail-closed"
    echo "  Redaction: default_safe"
    echo ""
    sleep 0.3
    echo "  → get_users        GET  /api/users          ✓ APPROVED  (low)"
    sleep 0.2
    echo "  → get_products     GET  /api/products        ✓ APPROVED  (low)"
    sleep 0.2
    echo "  → delete_user      DELETE /api/users/{id}    ✗ BLOCKED   (high)"
    sleep 0.2
    echo "  → create_order     POST /api/orders          ✓ APPROVED  (medium)"
    echo ""
    sleep 0.4
    echo "  ✓ 3 calls executed, 1 blocked"
    echo "  ✓ 4 decisions logged to audit trail"
    echo "  ✓ Drift check: 0 surface changes"
    echo ""
    sleep 0.3
    echo "  Every tool governed. Every call audited."
    SH
    chmod +x {{demo_dir}}/governed.sh
scenarios:
  - label: "Without Cask"
    surface: "terminal"
    prompt:
      style: "venv"
      env: ".venv"
      user: "user"
      host: "dev"
      path: "basename"
      symbol: "$"
    setup:
      - "cd {{demo_dir}}"
      - "clear"
    actions:
      - type: "bash ungoverned.sh"
      - wait_for: "what did it do"
        wait_mode: "screen"
        wait_timeout: "15s"
      - sleep: "1500ms"
  - label: "With Cask"
    surface: "terminal"
    prompt:
      style: "venv"
      env: ".venv"
      user: "user"
      host: "dev"
      path: "basename"
      symbol: "$"
    setup:
      - "cd {{demo_dir}}"
      - "clear"
    actions:
      - type: "bash governed.sh"
      - wait_for: "Every call audited"
        wait_mode: "screen"
        wait_timeout: "15s"
      - sleep: "1500ms"
